<div class="card shadow-sm mb-3 thread-item" data-thread-id="<%= thread.id %>">
  <!-- 親投稿 -->
  <div class="card-body border-bottom thread-root">
    <div class="d-flex align-items-start">
      <div class="flex-grow-1">
        <div class="d-flex align-items-center mb-2">
          <span class="badge bg-primary me-2">スレッド</span>
          <%= link_to user_path(thread.user), class: "user-link d-flex align-items-center text-decoration-none text-muted me-3" do %>
            <%= user_avatar_tag(thread.user, size: 24, class: "me-2") %>
            <strong class="text-dark"><%= thread.user.name %></strong>
          <% end %>
          <small class="text-muted">
            <i class="bi bi-clock"></i> <%= thread.created_at.strftime("%Y年%m月%d日 %H:%M") %>
          </small>
          <span class="badge bg-secondary ms-2">
            <i class="bi bi-chat"></i> <%= thread.replies.count %>レス
          </span>
        </div>
        <div class="thread-content">
          <%= simple_format(thread.description) %>
        </div>
      </div>
    </div>
  </div>

  <!-- レス投稿一覧 -->
  <% if thread.replies.any? %>
    <div class="replies-container">
      <% thread.replies.order(created_at: :asc).each do |reply| %>
        <div class="card-body border-bottom reply-item" data-reply-id="<%= reply.id %>">
          <div class="d-flex align-items-start">
            <div class="flex-grow-1">
              <div class="d-flex align-items-center mb-2">
                <%= link_to user_path(reply.user), class: "user-link d-flex align-items-center text-decoration-none text-muted me-3" do %>
                  <%= user_avatar_tag(reply.user, size: 20, class: "me-2") %>
                  <strong class="text-dark"><%= reply.user.name %></strong>
                <% end %>
                <small class="text-muted">
                  <i class="bi bi-clock"></i> <%= reply.created_at.strftime("%Y年%m月%d日 %H:%M") %>
                </small>
              </div>
              <div class="reply-content">
                <%= simple_format(reply.description) %>
              </div>
            </div>
          </div>
        </div>
      <% end %>
    </div>
  <% end %>

  <!-- レス投稿フォーム -->
  <div class="card-body bg-light reply-form-container">
    <%= form_with url: community_thread_replies_path(thread), method: :post, local: true do |f| %>
      <div class="input-group">
        <%= f.text_area :description, name: "reply[description]", class: "form-control", rows: 2, placeholder: "レスを投稿...", required: true %>
        <%= f.submit "投稿", class: "btn btn-primary" %>
      </div>
    <% end %>
  </div>
</div>
