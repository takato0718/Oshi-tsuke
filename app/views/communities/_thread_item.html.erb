<div class="card shadow-sm mb-3 thread-item" data-thread-id="<%= thread.id %>">
  <!-- 親投稿 -->
  <div class="card-body border-bottom thread-root">
    <div class="d-flex align-items-start">
      <div class="flex-grow-1">
        <div class="d-flex flex-wrap align-items-center mb-2 gap-2">
          <span class="badge bg-primary">スレッド</span>
          <%= link_to user_path(thread.user), class: "user-link d-flex align-items-center text-decoration-none text-muted" do %>
            <%= user_avatar_tag(thread.user, size: 24, class: "me-2 flex-shrink-0") %>
            <strong class="text-dark text-nowrap"><%= thread.user.name %></strong>
          <% end %>
          <small class="text-muted text-nowrap">
            <i class="bi bi-clock"></i> <%= thread.created_at.strftime("%Y年%m月%d日 %H:%M") %>
          </small>
          <span class="badge bg-secondary">
            <i class="bi bi-chat"></i> <%= thread.replies.count %>レス
          </span>
          <div class="ms-auto d-flex gap-2">
            <% if defined?(can_moderate) && can_moderate && thread.can_be_deleted_by?(current_user) %>
              <%= button_to destroy_thread_community_moderations_path(@community, thread_id: thread.id), 
                            method: :delete, 
                            data: { turbo_confirm: "本当にこのスレッドを削除しますか？" }, 
                            class: "btn btn-sm btn-outline-danger" do %>
                <i class="bi bi-trash"></i> 削除
              <% end %>
            <% end %>
            <% if defined?(current_user) && logged_in? && thread.user != current_user %>
              <button type="button" class="btn btn-sm btn-outline-secondary" data-bs-toggle="modal" data-bs-target="#reportModal<%= thread.id %>">
                <i class="bi bi-flag"></i> 報告
              </button>
            <% end %>
          </div>
        </div>
        <div class="thread-content">
          <%= simple_format(thread.description) %>
        </div>
      </div>
    </div>
  </div>

    <!-- レス投稿一覧 -->
  <% if thread.replies.any? %>
    <div class="replies-container">
      <%= render partial: 'communities/show/threads/reply_item', collection: thread.replies.order(created_at: :asc), as: :reply %>
    </div>
  <% end %>

  <!-- レス投稿フォーム -->
  <%= render 'communities/show/threads/reply_form', thread: thread %>

  <!-- 報告モーダル -->
  <%= render_report_modals_for_thread(thread) %>
</div>
